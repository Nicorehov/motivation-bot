services:
  vault:
    image: hashicorp/vault:1.14.0
    container_name: vault
    ports:
      - "8200:8200"
    environment:
      VAULT_DEV_ROOT_TOKEN_ID: "root-token"
      VAULT_DEV_LISTEN_ADDRESS: "0.0.0.0:8200"
    command: "server -dev"
    volumes:
      - vault_data:/vault/file
    networks:
      - localnet

  bot:
    build:
      context: ./bot
      dockerfile: Dockerfile
    container_name: telegram-quote-bot
    depends_on:
      - vault
    environment:
      BOT_TOKEN: "${BOT_TOKEN}"
      PROMETHEUS_URL: "http://prometheus:9090"
      VAULT_ADDR: "http://vault:8200"
      VAULT_TOKEN: "root-token"
    ports:
      - "8001:8000"
    networks:
      - localnet
    restart: unless-stopped

  prometheus:
    image: prom/prometheus:v2.46.0
    container_name: prometheus
    volumes:
      - ./infra/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml:ro
    ports:
      - "9090:9090"
    networks:
      - localnet

  grafana:
    image: grafana/grafana:10.0.0
    container_name: grafana
    environment:
      GF_SECURITY_ADMIN_PASSWORD: "admin"
    ports:
      - "3000:3000"
    depends_on:
      - prometheus
    networks:
      - localnet

volumes:
  vault_data:

networks:
  localnet:
    driver: bridge
